<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>GitHub YAML ä¿®æ”¹å™¨</title>
    <style>
        body { font-family: sans-serif; padding: 50px; max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; background-color: #0366d6; color: white; border: none; cursor: pointer; width: 100%; }
        button:hover { background-color: #0255b3; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #ddd; display: none; }
        .hint { font-size: 0.8em; color: #666; }
    </style>
</head>
<body>

<h2>ğŸ“ GitHub æ–‡ä»¶å¿«é€Ÿè¿½åŠ å·¥å…·</h2>

<div class="form-group">
    <label>GitHub Token:</label>
    <input type="password" id="ghToken" placeholder="ghp_xxxxxxxxxxxx">
</div>

<div class="form-group">
    <label>GitHub æ–‡ä»¶é“¾æ¥ (URL):</label>
    <input type="text" id="ghUrl" placeholder="https://github.com/user/repo/blob/main/config.yaml">
    <div class="hint">ç›´æ¥å¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„é“¾æ¥å³å¯</div>
</div>

<div class="form-group">
    <label>è¦è¿½åŠ çš„ä»£ç :</label>
    <input type="text" id="lineToAdd" placeholder="ä¾‹å¦‚:  new_config: true">
</div>

<button onclick="submitChange()">æäº¤ä¿®æ”¹</button>

<div id="result"></div>

<script>
    async function submitChange() {
        const token = document.getElementById('ghToken').value;
        const ghUrl = document.getElementById('ghUrl').value; // è·å– GitHub Link
        const lineToAdd = document.getElementById('lineToAdd').value;
        const resultDiv = document.getElementById('result');

        if (!token || !ghUrl) {
            alert("è¯·å¡«å†™ Token å’Œ GitHub é“¾æ¥");
            return;
        }

        resultDiv.style.display = 'block';
        resultDiv.innerText = 'å¤„ç†ä¸­...';
        resultDiv.style.backgroundColor = '#f0f0f0';

        try {
            const response = await fetch('/api/add-config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    githubUrl: ghUrl,  // å¯¹åº”åç«¯çš„å­—æ®µå
                    lineToAdd: lineToAdd,
                    token: token
                })
            });

            const text = await response.text();
            resultDiv.innerText = text;
            resultDiv.style.backgroundColor = response.ok ? "#e6fffa" : "#ffe6e6";
        } catch (error) {
            resultDiv.innerText = 'è¯·æ±‚å‡ºé”™: ' + error;
        }
    }
</script>
</body>
</html>
